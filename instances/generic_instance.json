
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Infrastructure CloudFormation template",
    "Parameters": {
      "KeyName" : {
          "Description" : "Name of existing EC2 key pair to enable SSH access to instances.",
          "Type" : "AWS::EC2::KeyPair::KeyName",
          "ConstraintDescription" : "Must be a valid EC2 key pair."
      },
      "ImageId": {
          "Description": "AMI id to use for this instance.",
          "Type":"AWS::EC2::Image::Id",
          "Default":""
      },
      "InstanceType" : {
          "Description" : "Size of EC2 instance to launch.",
          "Type": "String",
          "Default" : "t2.micro",
          "AllowedValues" : ["t2.micro","m3.medium"],
          "ConstraintDescription" : "Must be a valid EC2 instance type."
      },
      "Environment" : {
          "Description" : "Environment the resource is deployed to such (ie. prod, test, or dev).",
          "Type" : "String",
          "Default" : "dev",
          "AllowedValues" : ["dev","prod"]
      },
      "SecurityGroup" : {
          "Description": "Security group id for the instance.",
          "Type" : "String",
          "Default" : "sg-1bd50b7e"
      },
      "Team": {
          "Description": "The team the resource belongs to.",
          "Type": "String",
          "Default": "SS-INF"
      },
      "POC": {
          "Description": "Point of contact",
          "Type" : "String",
          "Default": "ro1423"
      },
      "Backup" : {
          "Description" : "Does the instance need to be backed up?",
          "Type" : "String",
          "Default" : "False"
      },
      "Subnet" : {
          "Description" : "Valid subnet within the VPC.",
          "Type" : "CommaDelimitedList"
      }
    },
    "Conditions": {
        "CreateProdResources" : {"Fn::Equals" : [{"Ref" : "Environment"}, "prod"]},
        "CreateDevResources" : {"Fn::Equals" : [ {"Ref": "Environment"}, "dev"]}
    },
    "Resources": {
        "Instance01" : {
            "Type" : "AWS::EC2::Instance",
            "Condition" : "CreateProdResources",
            "Properties" : {
                "Tags" : [
                    {"Key":"Name", "Value" : {"Ref":"Name"}},
                    {"Key":"POC", "Value":{"Ref":"POC"} },
                    {"Key":"Backup", "Value":{"Ref":"Backup"} },
                    {"Key":"Team", "Value":{"Ref":"Team"} },                    
                    {"Key":"Environment", "Value":{"Ref":"Environment"} }
                ],
                "KeyName" : { "Ref" : "KeyName" },
                "SecurityGroupIds" : [{ "Ref" : "SecurityGroup" }],
                "SubnetId" : { "Fn::Select" : ["0",{"Ref":"Subnet"}]},
                "ImageId" : { "Ref": "ImageId" },
                "InstanceType" : {"Ref" : "InstanceType" }
            }
        }
},

  "Outputs" : {}

}